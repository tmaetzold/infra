---
# Terminal environment setup playbook - Arch Linux only
- name: Set up terminal environment
  hosts: localhost
  become: true
  tasks:
    - name: Verify host is running Arch Linux
      ansible.builtin.fail:
        msg: "This playbook only supports Arch Linux. Detected: {{ ansible_os_family }}"
      when: ansible_os_family != "Archlinux"

    - name: Update package cache
      community.general.pacman:
        update_cache: true

    - name: Install base development tools (this shouldn't be possible)
      community.general.pacman:
        name:
          - base-devel
          - git
          - just
        state: present

    - name: Install shell and terminal tools
      community.general.pacman:
        name:
          - zsh
          - tmux
          - neovim
        state: present

    - name: Install Neovim dependencies for LazyVim
      community.general.pacman:
        name:
          - ripgrep
          - fd
          - python-pynvim
          - ncurses
          - lazygit
        state: present

    - name: Install programming languages
      community.general.pacman:
        name:
          - python
          - python-pip
          - python-pipx
          - uv
          - r
          - rust
        state: present

    - name: Install Node.js and npm
      community.general.pacman:
        name:
          - npm
        state: present

    - name: Install Docker
      community.general.pacman:
        name:
          - docker
          - docker-compose
        state: present

    - name: Enable Docker service
      ansible.builtin.systemd:
        name: docker
        enabled: true
        state: started

    - name: Create docker group
      ansible.builtin.group:
        name: docker
        state: present

    - name: Add user to docker group
      ansible.builtin.user:
        name: "{{ ansible_user_id }}"
        groups: docker
        append: true
      when: ansible_user_id is defined

    - name: Install AUR packages
      kewlfft.aur.aur:
        name: "{{ item }}"
        use: makepkg
        state: present
      become: false
      loop:
        - paru
        - zsh-pure-prompt
